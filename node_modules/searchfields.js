/*
 * Skoop search _operators. Encapsulates operators of available search _operators.
 */

var SearchFields = function (dbType) {
	// TODO: this should be a public enum
	this._operators = ["like", "contains", "not contains", "exists", "not exists", "ne", "gt", "lt",
	               "gte", "lte"];
	this._conjunctions = ["and", "or"];
	this.field = "_field_";
	this.value = "_value_";
	this.valArray = "_array_";
	// a : separated list identify the location of field, operator, and value
	this.operators = [];
	this.conjunctions = [];
	loadOperators(this, dbType);
	loadConjunctions(this, dbType);
}

function loadOperators(self, dbType) {
	if (dbType === "mongo") {
		for (var i = 0; i < self._operators.length; i++) {
			if (self._operators[i] === "like")
				self.operators[self._operators[i]] = "/^_value_/";
			else if (self._operators[i] === "contains")
				self.operators[self._operators[i]] = self.field + ":$in:" + self.valArray;
			else if (self._operators[i] === "not contains")
				self.operators[self._operators[i]] = self.field + ":$not:$all:" + self.valArray;
			else if (self._operators[i] === "exists")
				self.operators[self._operators[i]] = self.field + ":$exists:true";
			else if (self._operators[i] === "not exists")
				self.operators[self._operators[i]] = self.field + "$exists:false";
			else if (self._operators[i] === "ne")
				self.operators[self._operators[i]] = self.field + ":$ne:" + self.value;
			else if (self._operators[i] === "gt")
				self.operators[self._operators[i]] = self.field + ":$gt:" + self.value;
			else if (self._operators[i] === "lt")
				self.operators[self._operators[i]] = self.field + ":$lt:" + self.value;
			else if (self._operators[i] === "gte")
				self.operators[self._operators[i]] = self.field + ":$gte:" + self.value;
			else if (self._operators[i] === "lte")
				self.operators[self._operators[i]] = self.field + ":$lte:" + self.value;
		}
	}
}

function loadConjunctions(self, dbType) {
	if (dbType === "mongo") {
		for (var i = 0; i < self._conjunctions.length; i++) {
			if (self._conjunctions[i] === "and")
				self.conjunctions[self._conjunctions[i]] = "$and";
			else if (self._conjunctions[i] === "or")
				self.conjunctions[self._conjunctions[i]] = "$or";
		}
	}
}

exports.SearchFields = SearchFields;
